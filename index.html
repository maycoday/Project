<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aawaaz — Grievance Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400&family=DM+Mono:wght@300;400;500&family=Barlow:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="frontend/css/portal.css">
</head>
<body>

<!-- TRICOLOR TOP -->
<div class="tricolor"></div>

<!-- MODE SWITCHER -->
<div id="modeSwitcher">
  <div class="mode-brand">
    <div class="ashoka-wheel">
      <div class="wheel-spokes"></div>
    </div>
    <span>Aawaaz Portal &nbsp;—&nbsp; <span style="color:var(--gold);font-style:italic">आवाज़</span></span>
  </div>
  <div style="display:flex;align-items:center;gap:16px">
    <span class="mode-label">MODE</span>
    <div class="mode-toggle">
      <button class="mode-btn active" id="btnUser" onclick="setMode('user')">User Portal</button>
      <button class="mode-btn" id="btnSim" onclick="setMode('sim')">Simulation</button>
      <button class="mode-btn" id="btnAuth" onclick="setMode('authority')">Authority</button>
      <button class="mode-btn" id="btnPattern" onclick="goToPatternPage()">Pattern Detection</button>
    </div>
  </div>
</div>

<!-- GOVERNMENT HEADER -->
<div id="govHeader">
  <div class="gov-top">
    <div class="gov-logo-area">
      <div class="gov-emblem">
        <div class="gov-emblem-inner">
          <div class="gov-emblem-text">आ</div>
        </div>
      </div>
      <div class="gov-titles">
        <div class="gov-main-title">Aawaaz &nbsp;<span>आवाज़</span></div>
        <div class="gov-sub-title">Encrypted Grievance Redressal Portal &nbsp;·&nbsp; <em>Secure · Anonymous · Sovereign</em></div>
      </div>
    </div>
    <div class="gov-right">
      <div class="secure-badge">
        <div class="secure-dot"></div>
        <span>AES-256-GCM</span>
      </div>
      <div class="secure-badge" style="color:var(--navy);background:rgba(11,31,58,0.06);border-color:rgba(11,31,58,0.2)">
        🔒 E2E Encrypted
      </div>
      <div style="text-align:right">
        <div id="liveTime" style="font-size:10px"></div>
        <div style="font-size:9px;color:var(--muted);margin-top:1px">भारत सरकार</div>
      </div>
    </div>
  </div>
  <div class="gov-nav" id="govNavUser">
    <div class="gov-nav-link active" onclick="showUserPage('file')">File Complaint</div>
    <div class="gov-nav-link" onclick="showUserPage('track')">Track Complaint</div>
    <div class="gov-nav-link" onclick="showUserPage('about')">About & Features</div>
  </div>
  <div class="gov-nav" id="govNavSim" style="display:none">
    <div class="gov-nav-link active" onclick="showSimPage('live')">Live Simulation</div>
    <div class="gov-nav-link" onclick="showSimPage('flow')">System Flow</div>
    <div class="gov-nav-link" onclick="showSimPage('security')">Security Proofs</div>
  </div>
  <div class="gov-nav" id="govNavAuth" style="display:none">
    <div class="gov-nav-link active" onclick="showAuthPage('review')">Review Complaints</div>
    <div class="gov-nav-link" onclick="showAuthPage('stats')">Authority Stats</div>
  </div>
</div>

<!-- QUICK EXIT -->
<button id="quickExit" onclick="quickExit()">
  <span>✕</span>
  <span class="qt">Quick Exit</span>
</button>

<!-- WATERMARK -->
<div class="watermark">AAWAAZ · CONFIDENTIAL · ENCRYPTED</div>

<!-- ============================================================ -->
<!--  USER MODE                                                    -->
<!-- ============================================================ -->
<div id="userMode">

  <!-- FILE COMPLAINT -->
  <div id="page-file" class="page active">
    <div class="page-band">
      <div>
        <div class="page-band-title">File a <span>Grievance</span></div>
        <div class="page-band-sub">Your complaint is encrypted in your browser. No plaintext is ever transmitted.</div>
      </div>
      <div class="page-band-meta">
        <div id="cryptoStatus">Initializing crypto engine...</div>
        <div>Session: In-Memory Only</div>
      </div>
    </div>

    <div class="content">
      <!-- CRYPTO KEY DISPLAY -->
      <div class="crypto-section">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:10px">
          <div style="flex:1;min-width:220px">
            <div class="crypto-section-label">Your Session Encryption Key (AES-256)</div>
            <div class="crypto-key-display" id="userAesDisp">Generating...</div>
            <button class="reveal-toggle" onclick="toggleKey('userAesDisp')">Show / Hide Key</button>
          </div>
          <div style="flex:1;min-width:220px">
            <div class="token-box">
              <div class="token-label-text">🎫 Complaint Tracking Token</div>
              <div class="token-value-text" id="userToken">Generating...</div>
              <div class="token-warn-text">⚠ Save this token. It is the only way to track your complaint. No login required.</div>
            </div>
          </div>
        </div>
        <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.08);display:flex;gap:8px;flex-wrap:wrap">
          <span class="stamp navy" style="color:var(--gold);border-color:var(--gold)">✓ RAM Only</span>
          <span class="stamp navy" style="color:rgba(255,255,255,0.4);border-color:rgba(255,255,255,0.15)">✗ No localStorage</span>
          <span class="stamp navy" style="color:rgba(255,255,255,0.4);border-color:rgba(255,255,255,0.15)">✗ No sessionStorage</span>
          <span class="stamp navy" style="color:rgba(255,255,255,0.4);border-color:rgba(255,255,255,0.15)">✗ No Cookies</span>
        </div>
      </div>

      <!-- STEP 1: Incident Details -->
      <div class="form-section">
        <div class="form-section-header">
          <div class="form-section-num">1</div>
          <div class="form-section-title">Incident Details</div>
        </div>
        <div class="form-section-body">
          <div class="info-govt"><strong>Privacy Notice:</strong> All text you enter is encrypted locally using AES-256-GCM before any data is transmitted. The encryption key exists only in your browser's RAM for this session.</div>

          <!-- Live encryption preview -->
          <div class="enc-live" id="encLive">
            <div class="enc-pane">
              <div class="enc-pane-label plain">What you write</div>
              <div class="enc-plain-text" id="encPlainPrev">Start typing your complaint below...</div>
            </div>
            <div class="enc-arrow">→</div>
            <div class="enc-pane" style="border-color:rgba(255,103,0,0.2)">
              <div class="enc-pane-label cipher">What leaves your browser</div>
              <div class="enc-cipher-text" id="encCipherPrev">awaiting input...</div>
            </div>
          </div>

          <div class="field-group">
            <label class="field-label">Nature of Grievance <span class="req">*</span></label>
            <select class="field-input" id="incidentCategory">
              <option value="">-- Select Category --</option>
              <option>Workplace Harassment (POSH Act)</option>
              <option>Sexual Harassment</option>
              <option>Discrimination</option>
              <option>Wrongful Termination</option>
              <option>Hostile Work Environment</option>
              <option>Whistleblower Complaint</option>
              <option>Other</option>
            </select>
          </div>
          <div class="field-group">
            <label class="field-label">Describe the Incident <span class="req">*</span></label>
            <div class="field-note">This text is encrypted in real time as you type. The right panel above shows what actually gets transmitted — ciphertext only.</div>
            <textarea class="field-input" id="complaintInput" placeholder="Provide a detailed account of the incident(s), including dates, locations, and what occurred..." oninput="onComplaintType(this.value)"></textarea>
          </div>
          <div class="field-group">
            <label class="field-label">Date of Incident</label>
            <input type="date" class="field-input" id="incidentDate" style="max-width:240px">
          </div>
          <div class="field-group">
            <label class="field-label">Department / Division <span style="font-weight:400;text-transform:none;font-style:italic;font-size:10px;color:var(--muted)">(optional — leave blank to remain fully anonymous)</span></label>
            <input type="text" class="field-input" id="incidentDept" placeholder="e.g. Finance Department, Block B">
          </div>
        </div>
      </div>

      <!-- STEP 2: Authorities -->
      <div class="form-section">
        <div class="form-section-header">
          <div class="form-section-num">2</div>
          <div class="form-section-title">Select Receiving Authorities</div>
        </div>
        <div class="form-section-body">
          <div class="info-orange">Your complaint will be encrypted with each selected authority's <strong>public key</strong>. Only they can decrypt it using their private key. Unselected authorities are <strong>mathematically excluded</strong> — not just policy-excluded.</div>
          <div class="auth-grid">
            <div class="auth-sel hr" id="authHR" onclick="toggleAuth('HR')">
              <div class="auth-sel-check" id="chkHR"></div>
              <div class="auth-sel-icon">🏢</div>
              <div class="auth-sel-name">Human Resources</div>
              <div class="auth-sel-desc">Internal grievance cell. First point of contact for workplace complaints.</div>
            </div>
            <div class="auth-sel icc" id="authICC" onclick="toggleAuth('ICC')">
              <div class="auth-sel-check" id="chkICC"></div>
              <div class="auth-sel-icon">⚖️</div>
              <div class="auth-sel-name">IC Committee</div>
              <div class="auth-sel-desc">POSH Act mandated Internal Complaints Committee for sexual harassment.</div>
            </div>
            <div class="auth-sel ngo" id="authNGO" onclick="toggleAuth('NGO')">
              <div class="auth-sel-check" id="chkNGO"></div>
              <div class="auth-sel-icon">🌿</div>
              <div class="auth-sel-name">NGO Partner</div>
              <div class="auth-sel-desc">Independent third-party body. Use this to bypass internal authorities if needed.</div>
            </div>
          </div>
          <div class="bypass-note" id="bypassNote">
            ⚠️ <strong>Bypass Mode Active:</strong> You have deselected one or more internal authorities. This is by design — if an authority is involved in the harassment, you should exclude them. They cannot access your complaint even with full server access.
          </div>
        </div>
      </div>

      <!-- STEP 3: Options -->
      <div class="form-section">
        <div class="form-section-header">
          <div class="form-section-num">3</div>
          <div class="form-section-title">Submission Options</div>
        </div>
        <div class="form-section-body">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
            <div class="field-group">
              <label class="field-label">Delayed Release</label>
              <div class="field-note">Your complaint will be held encrypted and released to authorities only after this date. Leave blank for immediate release.</div>
              <input type="datetime-local" class="field-input" id="delayRelease">
            </div>
            <div class="field-group">
              <label class="field-label">Evidence Attachment</label>
              <div class="field-note">All metadata (GPS, device info, timestamps) will be automatically stripped before encryption.</div>
              <input type="file" class="field-input" onchange="handleFile(this)" accept="image/*,.pdf">
              <div id="metaStripStatus" style="margin-top:6px;font-size:10px;color:var(--muted)"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- SUBMIT -->
      <div style="display:flex;gap:12px;align-items:center;justify-content:flex-end;margin-bottom:8px">
        <button class="btn btn-outline" onclick="emergencyDelete()">⚡ Emergency Clear</button>
        <button class="btn btn-primary" id="submitBtn" onclick="submitComplaint()">Submit Encrypted Complaint →</button>
      </div>

      <div class="success-box" id="successBox">
        <div class="success-stamp">✓</div>
        <div class="success-title">Complaint Filed Successfully</div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:8px">Your Reference Number / Tracking Token:</div>
        <div class="success-ref" id="successRef">—</div>
        <div class="success-note">Save this reference number. It is the only way to track your complaint status. No personal information was stored or transmitted. Your complaint is encrypted and awaiting review by the authorities you selected.</div>
        <div style="display:flex;gap:10px;justify-content:center;margin-top:16px">
          <button class="btn btn-primary" onclick="showUserPage('track')">Track This Complaint →</button>
          <button class="btn btn-outline" onclick="window.print()">Print Reference</button>
        </div>
      </div>

    </div>
  </div>

  <!-- TRACK -->
  <div id="page-track" class="page" style="display:none">
    <div class="page-band">
      <div>
        <div class="page-band-title">Track Your <span>Complaint</span></div>
        <div class="page-band-sub">Enter your tracking token. No personal information required.</div>
      </div>
    </div>
    <div class="content">
      <div class="track-form">
        <h3>Complaint Status Enquiry</h3>
        <div class="field-group">
          <label class="field-label">Tracking Token <span class="req">*</span></label>
          <div class="field-note">The UUID token issued to you at the time of complaint submission.</div>
          <input type="text" class="field-input" id="trackInput" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" style="font-family:'DM Mono',monospace">
        </div>
        <button class="btn btn-primary" onclick="trackComplaint()">Fetch Status →</button>

        <div class="status-card" id="statusCard">
          <div class="status-badge">🟢 Active — Under Review</div>
          <div style="font-size:13px;color:var(--ink);margin-bottom:8px;font-family:'Crimson Pro',serif;font-size:16px">Complaint Reference: <strong id="trackRef">—</strong></div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:11px;color:var(--muted)">
            <div><strong style="color:var(--navy);display:block">Filed On</strong><span id="trackDate">—</span></div>
            <div><strong style="color:var(--navy);display:block">Authorities Notified</strong><span id="trackAuths">—</span></div>
            <div><strong style="color:var(--navy);display:block">Current Status</strong><span style="color:var(--green)">Under Review</span></div>
            <div><strong style="color:var(--navy);display:block">Encrypted</strong><span style="color:var(--green)">✓ Yes — AES-256-GCM</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ABOUT -->
  <div id="page-about" class="page" style="display:none">
    <div class="page-band">
      <div>
        <div class="page-band-title">About <span>Aawaaz</span></div>
        <div class="page-band-sub">Privacy-first grievance redressal — built on cryptographic guarantees, not policy promises.</div>
      </div>
    </div>
    <div class="content">
      <div class="about-grid">
        <div>
          <div class="about-card" style="margin-bottom:20px">
            <h3>Security Architecture</h3>
            <p style="font-size:13px;color:var(--muted);line-height:1.7;margin-bottom:16px">Aawaaz uses a layered cryptographic architecture to ensure that even if the server is fully compromised, your complaint remains unreadable. No policy document — mathematical proof.</p>
            <div class="feature-list-item">
              <div class="feature-icon">🔐</div>
              <div>
                <div class="feature-text-title">AES-256-GCM Encryption</div>
                <div class="feature-text-desc">Military-grade symmetric encryption performed entirely in your browser using the Web Crypto API. Your complaint is encrypted before a single byte leaves your device.</div>
              </div>
            </div>
            <div class="feature-list-item">
              <div class="feature-icon">🔑</div>
              <div>
                <div class="feature-text-title">RSA-OAEP Key Wrapping</div>
                <div class="feature-text-desc">Your AES key is encrypted (wrapped) with each selected authority's RSA-2048 public key. Only they can unwrap it using their private key — which never touches the server.</div>
              </div>
            </div>
            <div class="feature-list-item">
              <div class="feature-icon">🎯</div>
              <div>
                <div class="feature-text-title">Authority Bypass Control</div>
                <div class="feature-text-desc">You choose who receives your complaint. Unselected authorities receive no wrapped key — they are mathematically excluded regardless of their server access level.</div>
              </div>
            </div>
            <div class="feature-list-item">
              <div class="feature-icon">🫥</div>
              <div>
                <div class="feature-text-title">Zero Identity Architecture</div>
                <div class="feature-text-desc">No name, email, phone, or IP address is collected. Your tracking token is a random UUID. Even Aawaaz cannot identify you.</div>
              </div>
            </div>
            <div class="feature-list-item">
              <div class="feature-icon">🧮</div>
              <div>
                <div class="feature-text-title">Zero Knowledge Proofs</div>
                <div class="feature-text-desc">Prove organizational membership without revealing identity using ZKP circuits. Verify your complaint is legitimate without doxxing yourself.</div>
              </div>
            </div>
            <div class="feature-list-item">
              <div class="feature-icon">📷</div>
              <div>
                <div class="feature-text-title">EXIF Metadata Stripping</div>
                <div class="feature-text-desc">Photos contain GPS coordinates, device model, and timestamps. Aawaaz strips all metadata via canvas redraw before encryption. Your location remains yours.</div>
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="about-card" style="margin-bottom:16px">
            <h3>Safety Features</h3>
            <div class="feature-list-item">
              <div class="feature-icon">🥷</div>
              <div>
                <div class="feature-text-title">Stealth Mode</div>
                <div class="feature-text-desc">Tab title and favicon disguise the portal as a neutral page if someone looks over your shoulder.</div>
              </div>
            </div>
            <div class="feature-list-item">
              <div class="feature-icon">⚡</div>
              <div>
                <div class="feature-text-title">Quick Exit</div>
                <div class="feature-text-desc">One click wipes all data and redirects to a neutral site. No trace in browser history.</div>
              </div>
            </div>
            <div class="feature-list-item">
              <div class="feature-icon">⏰</div>
              <div>
                <div class="feature-text-title">Delayed Release</div>
                <div class="feature-text-desc">Schedule when your complaint is released to authorities. Acts as a safety mechanism — cancel anytime with your tracking token.</div>
              </div>
            </div>
            <div class="feature-list-item">
              <div class="feature-icon">🌐</div>
              <div>
                <div class="feature-text-title">IP Stripping</div>
                <div class="feature-text-desc">Requests route through a reverse proxy that strips all IP headers. The server log contains no user IP addresses.</div>
              </div>
            </div>
          </div>
          <div class="about-card">
            <h3>Legal Basis</h3>
            <p style="font-size:12px;color:var(--muted);line-height:1.6">Built in compliance with:</p>
            <ul style="font-size:11px;color:var(--ink2);line-height:2;padding-left:16px;margin-top:8px">
              <li>POSH Act, 2013</li>
              <li>Information Technology Act, 2000</li>
              <li>Digital Personal Data Protection Act, 2023</li>
              <li>Vishakha Guidelines</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

</div><!-- /userMode -->

<!-- ============================================================ -->
<!--  SIMULATION MODE                                             -->
<!-- ============================================================ -->
<div id="simMode">

  <!-- SIM: LIVE -->
  <div id="simpage-live" class="page active">
    <div class="sim-banner">
      🎓 Judge / Evaluator Mode — Live Cryptographic Simulation
      <span class="sim-banner-right">Real Web Crypto API · Every key is genuine · Open DevTools to verify</span>
    </div>

    <div class="sim-layout">

      <!-- USER PANEL -->
      <div class="sim-panel">
        <div class="sim-panel-header">
          <div>
            <div class="sim-panel-label">Panel A — User's Browser</div>
            <div class="sim-panel-title">Complaint Filing</div>
          </div>
          <div class="sim-panel-badge" style="background:rgba(255,103,0,0.15);color:var(--saffron)">CLIENT SIDE</div>
        </div>

        <!-- Step progress -->
        <div style="padding:16px 20px 0">
          <div class="sim-stepper">
            <div class="sim-step-node done" id="sn1" onclick="simSetStep(1)" title="Key Generation">1</div>
            <div class="sim-step-line" id="sl1"></div>
            <div class="sim-step-node active" id="sn2" onclick="simSetStep(2)" title="Write & Encrypt">2</div>
            <div class="sim-step-line" id="sl2"></div>
            <div class="sim-step-node" id="sn3" onclick="simSetStep(3)" title="Authority Selection">3</div>
            <div class="sim-step-line" id="sl3"></div>
            <div class="sim-step-node" id="sn4" onclick="simSetStep(4)" title="Submit">4</div>
          </div>
        </div>

        <div class="sim-panel-body">

          <!-- STEP 1 -->
          <div id="simStep1" style="display:none">
            <div class="judge-note">On initialization, the browser generates a real AES-256-GCM key using <code>crypto.subtle.generateKey()</code>. This key exists only in JS memory — never written to disk.</div>
            <div style="background:var(--navy);border-radius:2px;padding:14px;margin-bottom:12px">
              <div style="font-family:'DM Mono',monospace;font-size:8px;color:rgba(255,255,255,0.3);margin-bottom:6px;letter-spacing:0.1em">AES-256-GCM SESSION KEY</div>
              <div class="crypto-key-display revealed" id="simAesKey" style="font-size:9px">Generating...</div>
            </div>
            <div style="background:var(--navy);border-radius:2px;padding:14px">
              <div style="font-family:'DM Mono',monospace;font-size:8px;color:rgba(255,255,255,0.3);margin-bottom:6px;letter-spacing:0.1em">TRACKING TOKEN (UUID)</div>
              <div class="crypto-key-display revealed" id="simToken" style="font-size:10px;color:rgba(201,168,76,0.9)">Generating...</div>
            </div>
            <button class="btn btn-saffron" style="width:100%;margin-top:12px;justify-content:center" onclick="simSetStep(2)">Next: Write Complaint →</button>
          </div>

          <!-- STEP 2 -->
          <div id="simStep2">
            <div class="judge-note">As the user types, the complaint is encrypted in real time. The right pane shows actual AES-GCM ciphertext. Plaintext never leaves this panel.</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
              <div class="enc-pane">
                <div class="enc-pane-label plain" style="font-size:8px">PLAINTEXT (browser only)</div>
                <div class="enc-plain-text" id="simPlainPrev" style="font-size:11px;min-height:70px">Type below...</div>
              </div>
              <div class="enc-pane" style="border-color:rgba(255,103,0,0.2)">
                <div class="enc-pane-label cipher" style="font-size:8px">CIPHERTEXT (transmitted)</div>
                <div class="enc-cipher-text" id="simCipherPrev" style="min-height:70px">...</div>
              </div>
            </div>
            <textarea class="field-input" id="simComplaintInput" placeholder="Type a sample complaint here to see live encryption..." oninput="onSimType(this.value)" rows="3"></textarea>
            <button class="btn btn-saffron" style="width:100%;margin-top:8px;justify-content:center" onclick="simSetStep(3)">Next: Select Authorities →</button>
          </div>

          <!-- STEP 3 -->
          <div id="simStep3" style="display:none">
            <div class="judge-note">User selects which authorities can decrypt. For each selected authority, the AES key is wrapped (encrypted) using their RSA-2048 public key.</div>
            <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:12px">
              <div class="auth-sel hr" id="simAuthHR" onclick="simToggleAuth('HR')" style="padding:10px 12px">
                <div class="auth-sel-check" id="simChkHR"></div>
                <div style="display:flex;align-items:center;gap:8px">
                  <span>🏢</span>
                  <div>
                    <div class="auth-sel-name" style="font-size:11px">Human Resources</div>
                    <div class="auth-sel-desc" style="font-size:9px" id="simPubkeyHR">Loading RSA public key...</div>
                  </div>
                </div>
              </div>
              <div class="auth-sel icc" id="simAuthICC" onclick="simToggleAuth('ICC')" style="padding:10px 12px">
                <div class="auth-sel-check" id="simChkICC"></div>
                <div style="display:flex;align-items:center;gap:8px">
                  <span>⚖️</span>
                  <div>
                    <div class="auth-sel-name" style="font-size:11px">IC Committee</div>
                    <div class="auth-sel-desc" style="font-size:9px" id="simPubkeyICC">Loading RSA public key...</div>
                  </div>
                </div>
              </div>
              <div class="auth-sel ngo" id="simAuthNGO" onclick="simToggleAuth('NGO')" style="padding:10px 12px">
                <div class="auth-sel-check" id="simChkNGO"></div>
                <div style="display:flex;align-items:center;gap:8px">
                  <span>🌿</span>
                  <div>
                    <div class="auth-sel-name" style="font-size:11px">NGO Partner</div>
                    <div class="auth-sel-desc" style="font-size:9px" id="simPubkeyNGO">Loading RSA public key...</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="wrap-vis">
              <div class="wrap-vis-label">Key Wrapping Status</div>
              <div class="wrap-row" id="wrapRowHR">
                <div class="wrap-key">AES-KEY</div>
                <span style="color:var(--muted);padding:0 4px;font-size:10px">+</span>
                <div class="wrap-key">HR_PUB</div>
                <span class="wrap-lock">→</span>
                <div class="wrap-out" id="wrapOutHR">not wrapped</div>
              </div>
              <div class="wrap-row" id="wrapRowICC">
                <div class="wrap-key">AES-KEY</div>
                <span style="color:var(--muted);padding:0 4px;font-size:10px">+</span>
                <div class="wrap-key">ICC_PUB</div>
                <span class="wrap-lock">→</span>
                <div class="wrap-out" id="wrapOutICC">not wrapped</div>
              </div>
              <div class="wrap-row" id="wrapRowNGO">
                <div class="wrap-key">AES-KEY</div>
                <span style="color:var(--muted);padding:0 4px;font-size:10px">+</span>
                <div class="wrap-key">NGO_PUB</div>
                <span class="wrap-lock">→</span>
                <div class="wrap-out" id="wrapOutNGO">not wrapped</div>
              </div>
            </div>
            <button class="btn btn-saffron" style="width:100%;justify-content:center" onclick="simSetStep(4)">Next: Submit →</button>
          </div>

          <!-- STEP 4 -->
          <div id="simStep4" style="display:none">
            <div class="judge-note">Review the payload before submission. Notice: only ciphertext and wrapped keys. No plaintext, no identity, no IP.</div>
            <div class="terminal" style="margin-bottom:12px">
              <div class="terminal-titlebar"><div class="t-btn"></div><div class="t-btn"></div><div class="t-btn"></div><div class="terminal-name">payload.json → server</div></div>
              <div class="terminal-body">
                <div class="tl"><span class="tk">encrypted_blob:</span><span class="tv" id="simPPayload">submit to see...</span></div>
                <div class="tl"><span class="tk">wrapped_keys:</span><span class="tv" id="simPKeys">{}</span></div>
                <div class="tl"><span class="tk">tracking_hash:</span><span class="tv" id="simPToken">—</span></div>
                <div class="tl"><span class="tk">ip_address:</span><span class="tv red">[STRIPPED AT PROXY]</span></div>
                <div class="tl"><span class="tk">identity:</span><span class="tv red">[UNKNOWN — BY DESIGN]</span></div>
                <div class="tl"><span class="tk">plaintext:</span><span class="tv dim">[DOES NOT EXIST]</span></div>
              </div>
            </div>
            <button class="btn btn-green" style="width:100%;justify-content:center" id="simSubmitBtn" onclick="simSubmit()">🔐 Submit Encrypted Complaint</button>
            <div class="success-box" id="simSuccessBox" style="margin-top:12px;padding:16px;text-align:left">
              <div class="stamp green" style="margin-bottom:10px">✓ Submitted</div>
              <div style="font-size:11px;color:var(--muted)">Token: <span class="mono" id="simSuccessToken" style="color:var(--navy);font-size:10px"></span></div>
              <div style="font-size:10px;color:var(--muted);margin-top:6px">→ Check Authority Panel to see decryption in action</div>
            </div>
          </div>

        </div>
      </div>

      <!-- SERVER PANEL -->
      <div class="sim-panel" style="background:var(--cream)">
        <div class="sim-panel-header" style="background:var(--ink)">
          <div>
            <div class="sim-panel-label">Panel B — Server</div>
            <div class="sim-panel-title">What Server Sees</div>
          </div>
          <div class="sim-panel-badge" style="background:rgba(244,63,94,0.2);color:#f87171">BLIND</div>
        </div>
        <div class="sim-panel-body">
          <div class="blind-seal">
            <div class="blind-seal-title">Architecturally Blind</div>
            <div class="blind-seal-sub">No private keys. Cannot decrypt. Even full server compromise = only ciphertext.</div>
          </div>
          <div class="server-stat-grid">
            <div class="server-stat">
              <div class="server-stat-n gold" id="simSubCount">0</div>
              <div class="server-stat-l">COMPLAINTS</div>
            </div>
            <div class="server-stat">
              <div class="server-stat-n red">0</div>
              <div class="server-stat-l">IPs LOGGED</div>
            </div>
            <div class="server-stat">
              <div class="server-stat-n" style="color:#6ee7b7" id="simKeyCount">0</div>
              <div class="server-stat-l">WRAPPED KEYS</div>
            </div>
            <div class="server-stat">
              <div class="server-stat-n red">0</div>
              <div class="server-stat-l">PLAINTEXT</div>
            </div>
          </div>

          <div class="terminal">
            <div class="terminal-titlebar"><div class="t-btn"></div><div class="t-btn"></div><div class="t-btn"></div><div class="terminal-name">server.log</div></div>
            <div class="terminal-body" id="simServerLog" style="min-height:100px">
              <div style="color:rgba(255,255,255,0.2);font-size:8px">Awaiting requests...</div>
            </div>
          </div>

          <div style="font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);padding:8px 0;letter-spacing:0.1em;text-transform:uppercase">Stored Records</div>
          <div id="simStoredRecords">
            <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);text-align:center;padding:16px">No records yet</div>
          </div>
        </div>
      </div>

      <!-- AUTHORITY PANEL -->
      <div class="sim-panel">
        <div class="sim-panel-header">
          <div>
            <div class="sim-panel-label">Panel C — Authority Dashboard</div>
            <div class="sim-panel-title">Decrypt & Review</div>
          </div>
          <div class="sim-panel-badge" style="background:rgba(19,136,8,0.15);color:#6ee7b7">PRIVATE KEY</div>
        </div>
        <div class="sim-auth-tabs">
          <div class="sim-auth-tab hr active" onclick="simSwitchAuth('HR')">🏢 HR</div>
          <div class="sim-auth-tab icc" onclick="simSwitchAuth('ICC')">⚖️ ICC</div>
          <div class="sim-auth-tab ngo" onclick="simSwitchAuth('NGO')">🌿 NGO</div>
        </div>
        <div class="sim-panel-body" id="simAuthBody">

          <div id="simAuthContent_HR">
            <div style="background:var(--cream);border:1px solid var(--border);border-radius:2px;padding:12px;margin-bottom:12px">
              <div style="font-size:9px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);margin-bottom:6px">HR Private Key (RSA-2048)</div>
              <div class="crypto-key-display" id="simHRPrivKey" style="font-size:8px;color:var(--danger)">Loading...</div>
              <button class="reveal-toggle" style="background:var(--cream);color:var(--muted);border-color:var(--border2)" onclick="toggleKey('simHRPrivKey')">Show / Hide</button>
              <div style="font-size:9px;color:var(--muted);margin-top:6px;font-style:italic">In production: stored on HSM — never server-side</div>
            </div>
            <div id="hrSimComplaints"></div>
          </div>

          <div id="simAuthContent_ICC" style="display:none">
            <div style="background:var(--cream);border:1px solid var(--border);border-radius:2px;padding:12px;margin-bottom:12px">
              <div style="font-size:9px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);margin-bottom:6px">ICC Private Key (RSA-2048)</div>
              <div class="crypto-key-display" id="simICCPrivKey" style="font-size:8px;color:var(--danger)">Loading...</div>
              <button class="reveal-toggle" style="background:var(--cream);color:var(--muted);border-color:var(--border2)" onclick="toggleKey('simICCPrivKey')">Show / Hide</button>
            </div>
            <div id="iccSimComplaints"></div>
          </div>

          <div id="simAuthContent_NGO" style="display:none">
            <div style="background:var(--cream);border:1px solid var(--border);border-radius:2px;padding:12px;margin-bottom:12px">
              <div style="font-size:9px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);margin-bottom:6px">NGO Private Key (RSA-2048)</div>
              <div class="crypto-key-display" id="simNGOPrivKey" style="font-size:8px;color:var(--danger)">Loading...</div>
              <button class="reveal-toggle" style="background:var(--cream);color:var(--muted);border-color:var(--border2)" onclick="toggleKey('simNGOPrivKey')">Show / Hide</button>
            </div>
            <div id="ngoSimComplaints"></div>
          </div>

        </div>
      </div>

    </div><!-- /sim-layout -->

    <!-- CRYPTO LOG -->
    <button id="cryptoLogToggle" onclick="toggleCryptoLog()">📋 Crypto Log (<span id="simLogCount">0</span>)</button>
    <div id="cryptoLog">
      <div id="cryptoLogBody"></div>
    </div>

  </div><!-- /simpage-live -->

  <!-- SIM: FLOW -->
  <div id="simpage-flow" class="page" style="display:none;padding-top:0">
    <div class="sim-banner">System Architecture Flow<span class="sim-banner-right">Click any node to expand</span></div>
    <div class="content" style="max-width:900px">
      <div style="padding:24px 0">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">

          <div class="about-card" onclick="this.querySelector('.flow-detail').style.display=this.querySelector('.flow-detail').style.display==='none'?'block':'none'" style="cursor:pointer;transition:all 0.2s;border-left:4px solid var(--saffron)">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
              <div style="width:28px;height:28px;background:var(--navy);color:var(--white);border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;font-family:'DM Mono',monospace;flex-shrink:0">01</div>
              <div style="font-family:'Crimson Pro',serif;font-size:16px;font-weight:700;color:var(--navy)">Browser Key Generation</div>
            </div>
            <div style="font-size:11px;color:var(--muted);line-height:1.5">AES-256-GCM key generated entirely in-browser. Never leaves RAM. UUID tracking token created.</div>
            <div class="flow-detail" style="display:none;margin-top:10px;background:var(--navy);border-radius:2px;padding:10px;font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);line-height:1.8">crypto.subtle.generateKey({name:'AES-GCM',length:256},true,['encrypt','decrypt'])<br>→ CryptoKey in JS memory<br>crypto.randomUUID() → tracking token</div>
          </div>

          <div class="about-card" onclick="this.querySelector('.flow-detail').style.display=this.querySelector('.flow-detail').style.display==='none'?'block':'none'" style="cursor:pointer;border-left:4px solid var(--navy)">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
              <div style="width:28px;height:28px;background:var(--navy);color:var(--white);border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;font-family:'DM Mono',monospace;flex-shrink:0">02</div>
              <div style="font-family:'Crimson Pro',serif;font-size:16px;font-weight:700;color:var(--navy)">Complaint Encryption</div>
            </div>
            <div style="font-size:11px;color:var(--muted);line-height:1.5">Complaint text encrypted with AES key. Random 12-byte IV generated per submission. Plaintext discarded.</div>
            <div class="flow-detail" style="display:none;margin-top:10px;background:var(--navy);border-radius:2px;padding:10px;font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);line-height:1.8">crypto.getRandomValues(new Uint8Array(12)) → IV<br>crypto.subtle.encrypt({name:'AES-GCM',iv}, key, text)<br>→ ArrayBuffer ciphertext</div>
          </div>

          <div class="about-card" onclick="this.querySelector('.flow-detail').style.display=this.querySelector('.flow-detail').style.display==='none'?'block':'none'" style="cursor:pointer;border-left:4px solid var(--gold)">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
              <div style="width:28px;height:28px;background:var(--navy);color:var(--white);border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;font-family:'DM Mono',monospace;flex-shrink:0">03</div>
              <div style="font-family:'Crimson Pro',serif;font-size:16px;font-weight:700;color:var(--navy)">RSA Key Wrapping</div>
            </div>
            <div style="font-size:11px;color:var(--muted);line-height:1.5">AES key wrapped with each selected authority's RSA-2048 public key. Unselected = no key = cryptographic exclusion.</div>
            <div class="flow-detail" style="display:none;margin-top:10px;background:var(--navy);border-radius:2px;padding:10px;font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);line-height:1.8">crypto.subtle.wrapKey('raw',aesKey,authorityPublicKey,{name:'RSA-OAEP'})<br>→ ArrayBuffer wrappedKey per authority<br>Unselected: no wrap → mathematically excluded</div>
          </div>

          <div class="about-card" onclick="this.querySelector('.flow-detail').style.display=this.querySelector('.flow-detail').style.display==='none'?'block':'none'" style="cursor:pointer;border-left:4px solid var(--danger)">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
              <div style="width:28px;height:28px;background:var(--navy);color:var(--white);border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;font-family:'DM Mono',monospace;flex-shrink:0">04</div>
              <div style="font-family:'Crimson Pro',serif;font-size:16px;font-weight:700;color:var(--navy)">Blind Server Storage</div>
            </div>
            <div style="font-size:11px;color:var(--muted);line-height:1.5">Server stores only ciphertext and wrapped keys. No private keys, no plaintext, no IP. Architecturally incapable of decrypting.</div>
            <div class="flow-detail" style="display:none;margin-top:10px;background:var(--navy);border-radius:2px;padding:10px;font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);line-height:1.8">Stored: {encrypted_blob, iv, wrapped_keys[], tracking_hash}<br>Not stored: plaintext, user_ip, user_identity<br>Server compromise → attacker sees only ciphertext</div>
          </div>

          <div class="about-card" onclick="this.querySelector('.flow-detail').style.display=this.querySelector('.flow-detail').style.display==='none'?'block':'none'" style="cursor:pointer;border-left:4px solid var(--green)">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
              <div style="width:28px;height:28px;background:var(--navy);color:var(--white);border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;font-family:'DM Mono',monospace;flex-shrink:0">05</div>
              <div style="font-family:'Crimson Pro',serif;font-size:16px;font-weight:700;color:var(--navy)">Authority Decryption</div>
            </div>
            <div style="font-size:11px;color:var(--muted);line-height:1.5">Authority uses private key to unwrap AES key, then decrypts complaint. Two-step process. Private key never touches server.</div>
            <div class="flow-detail" style="display:none;margin-top:10px;background:var(--navy);border-radius:2px;padding:10px;font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);line-height:1.8">crypto.subtle.unwrapKey('raw',wrappedKey,privateKey,{name:'RSA-OAEP'},{name:'AES-GCM'})<br>→ Recovered AES key<br>crypto.subtle.decrypt({name:'AES-GCM',iv},aesKey,ciphertext)</div>
          </div>

          <div class="about-card" onclick="this.querySelector('.flow-detail').style.display=this.querySelector('.flow-detail').style.display==='none'?'block':'none'" style="cursor:pointer;border-left:4px solid var(--muted)">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
              <div style="width:28px;height:28px;background:var(--navy);color:var(--white);border-radius:2px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;font-family:'DM Mono',monospace;flex-shrink:0">06</div>
              <div style="font-family:'Crimson Pro',serif;font-size:16px;font-weight:700;color:var(--navy)">Anonymous Status Tracking</div>
            </div>
            <div style="font-size:11px;color:var(--muted);line-height:1.5">User checks status using only tracking token. Response encrypted back to user. No login, no identity, full anonymity maintained.</div>
            <div class="flow-detail" style="display:none;margin-top:10px;background:var(--navy);border-radius:2px;padding:10px;font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);line-height:1.8">User submits: hash(tracking_token)<br>Server: finds complaint, returns encrypted status<br>Client: decrypts with token-derived key<br>→ Full anonymity preserved</div>
          </div>

        </div>

        <div class="about-card" style="margin-top:16px">
          <h3>Security Guarantees</h3>
          <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;margin-top:12px">
            <div style="background:var(--cream);border:1px solid var(--border);border-radius:2px;padding:10px">
              <div class="stamp green" style="font-size:9px;margin-bottom:6px">✓ Forward Secrecy</div>
              <div style="font-size:10px;color:var(--muted);line-height:1.4">New key per complaint — one compromise reveals nothing else</div>
            </div>
            <div style="background:var(--cream);border:1px solid var(--border);border-radius:2px;padding:10px">
              <div class="stamp navy" style="font-size:9px;margin-bottom:6px">✓ Zero Trust</div>
              <div style="font-size:10px;color:var(--muted);line-height:1.4">Server holds no private keys — compromise yields only ciphertext</div>
            </div>
            <div style="background:var(--cream);border:1px solid var(--border);border-radius:2px;padding:10px">
              <div class="stamp orange" style="font-size:9px;margin-bottom:6px">✓ Auth Encryption</div>
              <div style="font-size:10px;color:var(--muted);line-height:1.4">AES-GCM provides confidentiality and tamper detection in one pass</div>
            </div>
            <div style="background:var(--cream);border:1px solid var(--border);border-radius:2px;padding:10px">
              <div class="stamp green" style="font-size:9px;margin-bottom:6px">✓ User Sovereignty</div>
              <div style="font-size:10px;color:var(--muted);line-height:1.4">Cryptographic exclusion of authorities — not policy-based, math-based</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- SIM: SECURITY -->
  <div id="simpage-security" class="page" style="display:none;padding-top:0">
    <div class="sim-banner">Security Proofs & Technical Specifications<span class="sim-banner-right">For technical evaluators</span></div>
    <div class="content" style="max-width:900px">
      <div style="padding:24px 0;display:grid;gap:16px">
        <div class="about-card">
          <h3>Zero Knowledge Proof Simulation</h3>
          <div style="font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:16px">Prove organizational membership without revealing identity. Uses Groth16 circuit over a Merkle membership tree.</div>
          <div style="display:grid;grid-template-columns:1fr auto 1fr auto 1fr;gap:8px;align-items:center;margin-bottom:16px">
            <div style="background:var(--cream);border:1px solid var(--border);border-radius:2px;padding:12px;text-align:center">
              <div style="font-size:9px;color:var(--muted);font-family:'DM Mono',monospace;margin-bottom:4px">USER PROVES</div>
              <div style="font-size:12px;font-weight:600;color:var(--navy)">"I belong to Org"</div>
              <div style="font-size:9px;color:var(--muted);margin-top:4px;font-family:'DM Mono',monospace">identity: HIDDEN</div>
            </div>
            <div style="color:var(--saffron);font-size:20px;text-align:center">→</div>
            <div style="background:var(--cream);border:1px solid var(--border);border-radius:2px;padding:12px;text-align:center">
              <div style="font-size:9px;color:var(--muted);font-family:'DM Mono',monospace;margin-bottom:4px">VERIFIER CHECKS</div>
              <div style="font-size:12px;font-weight:600;color:var(--navy)">proof ≠ secret</div>
              <div style="font-size:9px;color:var(--muted);margin-top:4px;font-family:'DM Mono',monospace">sees: π only</div>
            </div>
            <div style="color:var(--saffron);font-size:20px;text-align:center">→</div>
            <div style="background:rgba(19,136,8,0.05);border:1px solid rgba(19,136,8,0.2);border-radius:2px;padding:12px;text-align:center">
              <div style="font-size:9px;color:var(--muted);font-family:'DM Mono',monospace;margin-bottom:4px">RESULT</div>
              <div style="font-size:12px;font-weight:700;color:var(--green)">Verified ✓</div>
              <div style="font-size:9px;color:var(--muted);margin-top:4px;font-family:'DM Mono',monospace">identity: UNKNOWN</div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="runZKP()">Run ZKP Simulation</button>
          <div id="zkpOutput" style="display:none;margin-top:12px;background:var(--navy);border-radius:2px;padding:12px;font-family:'DM Mono',monospace;font-size:9px;color:var(--gold);line-height:2"></div>
        </div>

        <div class="about-card">
          <h3>EXIF Metadata Stripping Demo</h3>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div>
              <div style="font-size:10px;font-weight:700;letter-spacing:0.08em;color:var(--danger);text-transform:uppercase;margin-bottom:8px">Before — Dangerous</div>
              <div style="background:var(--cream);border:1px solid rgba(220,38,38,0.2);border-radius:2px">
                <div id="metaBefore">
                  <div style="display:flex;justify-content:space-between;padding:6px 10px;border-bottom:1px solid var(--border);font-size:10px"><span style="color:var(--muted);font-family:'DM Mono',monospace">GPS</span><span style="color:var(--danger)">28.6139°N, 77.2090°E</span></div>
                  <div style="display:flex;justify-content:space-between;padding:6px 10px;border-bottom:1px solid var(--border);font-size:10px"><span style="color:var(--muted);font-family:'DM Mono',monospace">Device</span><span style="color:var(--danger)">Samsung Galaxy S21</span></div>
                  <div style="display:flex;justify-content:space-between;padding:6px 10px;border-bottom:1px solid var(--border);font-size:10px"><span style="color:var(--muted);font-family:'DM Mono',monospace">Timestamp</span><span style="color:var(--danger)">2025-02-14 09:23</span></div>
                  <div style="display:flex;justify-content:space-between;padding:6px 10px;font-size:10px"><span style="color:var(--muted);font-family:'DM Mono',monospace">Software</span><span style="color:var(--danger)">Camera 11.0.3</span></div>
                </div>
              </div>
            </div>
            <div>
              <div style="font-size:10px;font-weight:700;letter-spacing:0.08em;color:var(--green);text-transform:uppercase;margin-bottom:8px">After Strip — Safe</div>
              <div style="background:var(--cream);border:1px solid rgba(19,136,8,0.2);border-radius:2px">
                <div id="metaAfter">
                  <div style="display:flex;justify-content:space-between;padding:6px 10px;border-bottom:1px solid var(--border);font-size:10px"><span style="color:var(--muted);font-family:'DM Mono',monospace">GPS</span><span style="color:var(--muted);text-decoration:line-through">[STRIPPED]</span></div>
                  <div style="display:flex;justify-content:space-between;padding:6px 10px;border-bottom:1px solid var(--border);font-size:10px"><span style="color:var(--muted);font-family:'DM Mono',monospace">Device</span><span style="color:var(--muted);text-decoration:line-through">[STRIPPED]</span></div>
                  <div style="display:flex;justify-content:space-between;padding:6px 10px;border-bottom:1px solid var(--border);font-size:10px"><span style="color:var(--muted);font-family:'DM Mono',monospace">Timestamp</span><span style="color:var(--muted);text-decoration:line-through">[STRIPPED]</span></div>
                  <div style="display:flex;justify-content:space-between;padding:6px 10px;font-size:10px"><span style="color:var(--muted);font-family:'DM Mono',monospace">Software</span><span style="color:var(--muted);text-decoration:line-through">[STRIPPED]</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="about-card">
          <h3>Emergency Delete</h3>
          <div style="font-size:12px;color:var(--muted);margin-bottom:12px">One action wipes all traces from the browser. No forensic recovery possible after this operation.</div>
          <button class="btn" style="background:var(--danger);color:var(--white);width:100%;justify-content:center;margin-bottom:12px" onclick="runEmergencyDeleteSim()">⚡ Simulate Emergency Delete</button>
          <div id="emergencySteps" style="display:none">
            <div class="dstep" id="edel1"><div class="dstep-icon">○</div>Clearing complaint draft from memory...</div>
            <div class="dstep" id="edel2"><div class="dstep-icon">○</div>sessionStorage.clear()</div>
            <div class="dstep" id="edel3"><div class="dstep-icon">○</div>localStorage.clear()</div>
            <div class="dstep" id="edel4"><div class="dstep-icon">○</div>caches.keys() → deleting all service worker caches...</div>
            <div class="dstep" id="edel5"><div class="dstep-icon">○</div>IndexedDB.deleteDatabase() for all databases...</div>
            <div class="dstep" id="edel6"><div class="dstep-icon">○</div>✓ All browser data eliminated</div>
          </div>
        </div>

      </div>
    </div>
  </div>

</div><!-- /simMode -->

<!-- ============================================================ -->
<!--  AUTHORITY MODE                                              -->
<!-- ============================================================ -->
<div id="authorityMode" style="display:none">

  <!-- AUTHORITY SELECTION -->
  <div id="auth-review" class="page active">
    <div class="page-band">
      <div>
        <div class="page-band-title">Authority <span>Dashboard</span></div>
        <div class="page-band-sub">Review encrypted complaints filed with your organization.</div>
      </div>
      <div class="page-band-meta">
        <div id="authCurrent">Select Authority</div>
      </div>
    </div>

    <div class="content">
      <!-- AUTHORITY SELECTOR -->
      <div style="margin-bottom:24px">
        <div style="font-size:13px;font-weight:700;color:var(--navy);letter-spacing:0.04em;text-transform:uppercase;margin-bottom:12px">Select Your Authority</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
          <div class="auth-sel hr" id="authCardHR" onclick="selectAuthority('HR')" style="cursor:pointer;padding:16px;text-align:center;border:2px solid var(--border)">
            <div style="font-size:32px;margin-bottom:8px">👨‍💼</div>
            <div style="font-size:13px;font-weight:700;color:var(--navy)">HR Department</div>
            <div style="font-size:11px;color:var(--muted);margin-top:4px">Human Resources</div>
            <div style="font-size:10px;color:var(--muted);margin-top:6px" id="hrCount">0 complaints</div>
          </div>
          <div class="auth-sel icc" id="authCardICC" onclick="selectAuthority('ICC')" style="cursor:pointer;padding:16px;text-align:center;border:2px solid var(--border)">
            <div style="font-size:32px;margin-bottom:8px">⚖️</div>
            <div style="font-size:13px;font-weight:700;color:var(--navy)">IC Committee</div>
            <div style="font-size:11px;color:var(--muted);margin-top:4px">POSH Act Compliance</div>
            <div style="font-size:10px;color:var(--muted);margin-top:6px" id="iccCount">0 complaints</div>
          </div>
          <div class="auth-sel ngo" id="authCardNGO" onclick="selectAuthority('NGO')" style="cursor:pointer;padding:16px;text-align:center;border:2px solid var(--border)">
            <div style="font-size:32px;margin-bottom:8px">🤝</div>
            <div style="font-size:13px;font-weight:700;color:var(--navy)">NGO Partner</div>
            <div style="font-size:11px;color:var(--muted);margin-top:4px">Independent Review</div>
            <div style="font-size:10px;color:var(--muted);margin-top:6px" id="ngoCount">0 complaints</div>
          </div>
        </div>
      </div>

      <!-- COMPLAINTS LIST -->
      <div id="authComplaintsList" style="display:none">
        <div style="background:var(--white);border:1px solid var(--border);border-radius:2px;margin-bottom:20px">
          <div style="background:var(--cream);padding:16px;border-bottom:1px solid var(--border)">
            <div style="font-size:12px;font-weight:700;color:var(--navy);letter-spacing:0.04em;text-transform:uppercase">
              <span id="selectedAuthLabel">---</span> - Complaints to Review
            </div>
            <div style="font-size:11px;color:var(--muted);margin-top:4px">
              Total: <strong id="totalComplaintsCount">0</strong> | Reviewed: <strong id="reviewedCount">0</strong> | Pending: <strong id="pendingCount">0</strong>
            </div>
          </div>
          <div id="complaintsList" style="padding:16px">
            <div style="text-align:center;color:var(--muted);padding:32px;font-style:italic">
              No complaints assigned to this authority yet.
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- AUTHORITY STATS -->
  <div id="auth-stats" class="page" style="display:none">
    <div class="page-band">
      <div>
        <div class="page-band-title">Authority <span>Statistics</span></div>
        <div class="page-band-sub">Complaint resolution metrics and trends.</div>
      </div>
    </div>
    <div class="content">
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px">
        <div style="background:var(--white);border:1px solid var(--border);border-radius:2px;padding:16px;text-align:center">
          <div style="font-size:28px;font-weight:700;color:var(--navy)" id="statTotal">0</div>
          <div style="font-size:11px;color:var(--muted);margin-top:4px;text-transform:uppercase;letter-spacing:0.06em">Total Assigned</div>
        </div>
        <div style="background:var(--white);border:1px solid var(--border);border-radius:2px;padding:16px;text-align:center">
          <div style="font-size:28px;font-weight:700;color:var(--danger)" id="statPending">0</div>
          <div style="font-size:11px;color:var(--muted);margin-top:4px;text-transform:uppercase;letter-spacing:0.06em">Pending Review</div>
        </div>
        <div style="background:var(--white);border:1px solid var(--border);border-radius:2px;padding:16px;text-align:center">
          <div style="font-size:28px;font-weight:700;color:var(--green)" id="statResolved">0</div>
          <div style="font-size:11px;color:var(--muted);margin-top:4px;text-transform:uppercase;letter-spacing:0.06em">Resolved</div>
        </div>
        <div style="background:var(--white);border:1px solid var(--border);border-radius:2px;padding:16px;text-align:center">
          <div style="font-size:28px;font-weight:700;color:var(--navy)" id="statAvgTime">—</div>
          <div style="font-size:11px;color:var(--muted);margin-top:4px;text-transform:uppercase;letter-spacing:0.06em">Avg. Time</div>
        </div>
      </div>
      <div style="background:var(--white);border:1px solid var(--border);border-radius:2px;padding:16px">
        <div style="font-size:12px;font-weight:700;color:var(--navy);letter-spacing:0.04em;text-transform:uppercase;margin-bottom:12px">
          Recent Activity
        </div>
        <div id="authActivity" style="font-size:11px;color:var(--muted)">
          <div style="text-align:center;padding:16px;font-style:italic">No activity yet</div>
        </div>
      </div>
    </div>
  </div>

</div><!-- /authorityMode -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" crossorigin="anonymous"></script>
<script src="frontend/js/supabaseConfig.js"></script>
<script src="frontend/js/dataService.js"></script>
<script src="frontend/js/portal.js"></script>
</body>
</html>